{
  "version": 3,
  "sources": ["../../dist/index.js"],
  "sourcesContent": ["\"use strict\";\nvar __create = Object.create;\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __getProtoOf = Object.getPrototypeOf;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(\n  // If the importer is in node compatibility mode or this is not an ESM\n  // file that has been converted to a CommonJS file using a Babel-\n  // compatible transform (i.e. \"__esModule\" has not been set), then set\n  // \"default\" to the CommonJS \"module.exports\" for node compatibility.\n  isNodeMode || !mod || !mod.__esModule ? __defProp(target, \"default\", { value: mod, enumerable: true }) : target,\n  mod\n));\n\n// src/server.ts\nvar import_express = __toESM(require(\"express\"));\nvar import_http = __toESM(require(\"http\"));\nvar import_socket = require(\"socket.io\");\nvar app = (0, import_express.default)();\nvar server = import_http.default.createServer(app);\nvar io = new import_socket.Server(server, {\n  cors: {\n    origin: \"*\",\n    methods: [\"GET\", \"POST\", \"DELETE\"],\n    allowedHeaders: [\"my-custom-header\"],\n    credentials: true\n  },\n  maxHttpBufferSize: 1e8\n});\nvar port = process.env.PORT || 8e3;\nserver.listen(port, () => {\n  console.log(`listening on *:${port}`);\n});\nvar server_default = io;\n\n// src/utils.ts\nvar insideOfRange = (value, range) => {\n  if (value >= range[0] && value <= range[1])\n    return true;\n  else\n    return false;\n};\nvar defaultUser = {\n  id: \"\",\n  user: {\n    name: \"\",\n    bio: \"\",\n    age: 50,\n    profilePicture: \"\",\n    uid: \"\",\n    gender: void 0,\n    authenticated: false,\n    matchingConfig: {\n      from: 50,\n      to: 50,\n      lang: \"noOne\",\n      genders: [void 0]\n    }\n  }\n};\n\n// src/index.ts\nvar langsBucket = {};\nvar removeFromBucket = (id, lang) => {\n  const index = langsBucket[lang].findIndex((obj) => obj.id === id);\n  if (index === -1)\n    return;\n  langsBucket[lang].splice(index, 1);\n};\nserver_default.on(\"connection\", (socket) => {\n  socket.once(\"add_user\", (user) => {\n    if (!user?.uid)\n      return;\n    console.log(`\n      a user connected: ${user.age}y ${user.gender}\n      that search for ${user.matchingConfig.genders.join(\";\")}\n      with age [${user.matchingConfig.from} - ${user.matchingConfig.to}]\n    `);\n    let userConection;\n    userConection = {\n      id: socket.id,\n      user: {\n        ...defaultUser.user,\n        ...user,\n        matchingConfig: {\n          ...user.matchingConfig\n        }\n      }\n    };\n    const { lang, from, to } = userConection.user.matchingConfig;\n    if (!langsBucket[`${lang}`])\n      langsBucket[`${lang}`] = [];\n    langsBucket[`${lang}`].push(userConection);\n    try {\n      let filtered = langsBucket[`${lang}`].filter((p) => p.id !== userConection.id);\n      filtered = filtered.filter(\n        (person) => insideOfRange(person.user.age, [from, to]) && insideOfRange(userConection.user.age, [person.user.matchingConfig.from, person.user.matchingConfig.to])\n      );\n      filtered = filtered.filter(\n        (person) => person.user.matchingConfig.genders.includes(userConection.user.gender) && userConection.user.matchingConfig.genders.includes(person.user.gender)\n      );\n      if (!!filtered[0]) {\n        removeFromBucket(filtered[0].id, filtered[0].user.matchingConfig.lang);\n        removeFromBucket(userConection.id, userConection.user.matchingConfig.lang);\n        server_default.to(filtered[0].id).emit(\"match\", userConection.user);\n        server_default.to(userConection.id).emit(\"match\", filtered[0].user);\n      }\n    } catch (e) {\n      console.log(e);\n    }\n  });\n  socket.on(\"disconnect\", (reason) => {\n    console.log(\"a user disconnect\", socket.id);\n    for (const lang of Object.keys(langsBucket)) {\n      removeFromBucket(socket.id, lang);\n    }\n  });\n});\n"],
  "mappings": ";AACA,IAAI,WAAW,OAAO;AACtB,IAAI,YAAY,OAAO;AACvB,IAAI,mBAAmB,OAAO;AAC9B,IAAI,oBAAoB,OAAO;AAC/B,IAAI,eAAe,OAAO;AAC1B,IAAI,eAAe,OAAO,UAAU;AACpC,IAAI,cAAc,CAAC,IAAI,MAAM,QAAQ,SAAS;AAC5C,MAAI,QAAQ,OAAO,SAAS,YAAY,OAAO,SAAS,YAAY;AAClE,aAAS,OAAO,kBAAkB,IAAI;AACpC,UAAI,CAAC,aAAa,KAAK,IAAI,GAAG,KAAK,QAAQ;AACzC,kBAAU,IAAI,KAAK,EAAE,KAAK,MAAM,KAAK,MAAM,YAAY,EAAE,OAAO,iBAAiB,MAAM,GAAG,MAAM,KAAK,WAAW,CAAC;AAAA,EACvH;AACA,SAAO;AACT;AACA,IAAI,UAAU,CAAC,KAAK,YAAY,YAAY,SAAS,OAAO,OAAO,SAAS,aAAa,GAAG,CAAC,IAAI,CAAC,GAAG;AAAA,EAKnG,cAAc,CAAC,OAAO,CAAC,IAAI,aAAa,UAAU,QAAQ,WAAW,EAAE,OAAO,KAAK,YAAY,KAAK,CAAC,IAAI;AAAA,EACzG;AACF;AAGA,IAAI,iBAAiB,QAAQ,QAAQ,SAAS,CAAC;AAC/C,IAAI,cAAc,QAAQ,QAAQ,MAAM,CAAC;AACzC,IAAI,gBAAgB,QAAQ,WAAW;AACvC,IAAI,OAAO,GAAG,eAAe,SAAS;AACtC,IAAI,SAAS,YAAY,QAAQ,aAAa,GAAG;AACjD,IAAI,KAAK,IAAI,cAAc,OAAO,QAAQ;AAAA,EACxC,MAAM;AAAA,IACJ,QAAQ;AAAA,IACR,SAAS,CAAC,OAAO,QAAQ,QAAQ;AAAA,IACjC,gBAAgB,CAAC,kBAAkB;AAAA,IACnC,aAAa;AAAA,EACf;AAAA,EACA,mBAAmB;AACrB,CAAC;AACD,IAAI,OAAO,QAAQ,IAAI,QAAQ;AAC/B,OAAO,OAAO,MAAM,MAAM;AACxB,UAAQ,IAAI,kBAAkB,MAAM;AACtC,CAAC;AACD,IAAI,iBAAiB;AAGrB,IAAI,gBAAgB,CAAC,OAAO,UAAU;AACpC,MAAI,SAAS,MAAM,MAAM,SAAS,MAAM;AACtC,WAAO;AAAA;AAEP,WAAO;AACX;AACA,IAAI,cAAc;AAAA,EAChB,IAAI;AAAA,EACJ,MAAM;AAAA,IACJ,MAAM;AAAA,IACN,KAAK;AAAA,IACL,KAAK;AAAA,IACL,gBAAgB;AAAA,IAChB,KAAK;AAAA,IACL,QAAQ;AAAA,IACR,eAAe;AAAA,IACf,gBAAgB;AAAA,MACd,MAAM;AAAA,MACN,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,SAAS,CAAC,MAAM;AAAA,IAClB;AAAA,EACF;AACF;AAGA,IAAI,cAAc,CAAC;AACnB,IAAI,mBAAmB,CAAC,IAAI,SAAS;AACnC,QAAM,QAAQ,YAAY,MAAM,UAAU,CAAC,QAAQ,IAAI,OAAO,EAAE;AAChE,MAAI,UAAU;AACZ;AACF,cAAY,MAAM,OAAO,OAAO,CAAC;AACnC;AACA,eAAe,GAAG,cAAc,CAAC,WAAW;AAC1C,SAAO,KAAK,YAAY,CAAC,SAAS;AAChC,QAAI,EAAC,6BAAM;AACT;AACF,YAAQ,IAAI;AAAA,0BACU,KAAK,QAAQ,KAAK;AAAA,wBACpB,KAAK,eAAe,QAAQ,KAAK,GAAG;AAAA,kBAC1C,KAAK,eAAe,UAAU,KAAK,eAAe;AAAA,KAC/D;AACD,QAAI;AACJ,oBAAgB;AAAA,MACd,IAAI,OAAO;AAAA,MACX,MAAM;AAAA,QACJ,GAAG,YAAY;AAAA,QACf,GAAG;AAAA,QACH,gBAAgB;AAAA,UACd,GAAG,KAAK;AAAA,QACV;AAAA,MACF;AAAA,IACF;AACA,UAAM,EAAE,MAAM,MAAM,GAAG,IAAI,cAAc,KAAK;AAC9C,QAAI,CAAC,YAAY,GAAG;AAClB,kBAAY,GAAG,UAAU,CAAC;AAC5B,gBAAY,GAAG,QAAQ,KAAK,aAAa;AACzC,QAAI;AACF,UAAI,WAAW,YAAY,GAAG,QAAQ,OAAO,CAAC,MAAM,EAAE,OAAO,cAAc,EAAE;AAC7E,iBAAW,SAAS;AAAA,QAClB,CAAC,WAAW,cAAc,OAAO,KAAK,KAAK,CAAC,MAAM,EAAE,CAAC,KAAK,cAAc,cAAc,KAAK,KAAK,CAAC,OAAO,KAAK,eAAe,MAAM,OAAO,KAAK,eAAe,EAAE,CAAC;AAAA,MAClK;AACA,iBAAW,SAAS;AAAA,QAClB,CAAC,WAAW,OAAO,KAAK,eAAe,QAAQ,SAAS,cAAc,KAAK,MAAM,KAAK,cAAc,KAAK,eAAe,QAAQ,SAAS,OAAO,KAAK,MAAM;AAAA,MAC7J;AACA,UAAI,CAAC,CAAC,SAAS,IAAI;AACjB,yBAAiB,SAAS,GAAG,IAAI,SAAS,GAAG,KAAK,eAAe,IAAI;AACrE,yBAAiB,cAAc,IAAI,cAAc,KAAK,eAAe,IAAI;AACzE,uBAAe,GAAG,SAAS,GAAG,EAAE,EAAE,KAAK,SAAS,cAAc,IAAI;AAClE,uBAAe,GAAG,cAAc,EAAE,EAAE,KAAK,SAAS,SAAS,GAAG,IAAI;AAAA,MACpE;AAAA,IACF,SAAS,GAAP;AACA,cAAQ,IAAI,CAAC;AAAA,IACf;AAAA,EACF,CAAC;AACD,SAAO,GAAG,cAAc,CAAC,WAAW;AAClC,YAAQ,IAAI,qBAAqB,OAAO,EAAE;AAC1C,eAAW,QAAQ,OAAO,KAAK,WAAW,GAAG;AAC3C,uBAAiB,OAAO,IAAI,IAAI;AAAA,IAClC;AAAA,EACF,CAAC;AACH,CAAC;",
  "names": []
}
