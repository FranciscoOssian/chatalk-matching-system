{
  "version": 3,
  "sources": ["../../src/index.ts"],
  "sourcesContent": ["import io from './server'\n\nimport { langsBucketType, UserSocketType, UserType } from './types'\nimport { insideOfRange } from './utils'\n\nlet langsBucket: langsBucketType = {}\n\nconst removeFromBucket = (id: string, lang?: string) => {\n  if (lang) {\n    const index = langsBucket[lang].findIndex(obj => obj.id === id);\n    if (index === -1) return;\n    langsBucket[lang].splice(index, 1);\n  } else {\n    // Remover o usu\u00E1rio de todas as linguagens no bucket\n    Object.values(langsBucket).forEach(lang => {\n      const index = lang.findIndex(obj => obj.id === id);\n      if (index !== -1) {\n        lang.splice(index, 1);\n      }\n    });\n  }\n};\n\n\nconst onUserAdd = (user: UserType, socketId: string) => {\n\n  console.log('init user add')\n  \n  const lang = user.matchingConfig.lang\n  const {from, to} = user.matchingConfig\n  \n  langsBucket[`${lang}`].push({id: socketId, user})\n\n  const filteredLang = langsBucket[`${lang}`].filter(p => p.user.uid !== user.uid)\n  \n  const filteredAge = filteredLang.filter(p => {\n    const f = p.user.matchingConfig.from;\n    const t = p.user.matchingConfig.to;\n    return insideOfRange(p.user.age, [from, to]) && insideOfRange(user.age, [f, t])\n  })\n\n  const filteredGender = filteredAge.filter(p => {\n    console.log(p.user.matchingConfig.genders, p.user.gender)\n    console.log(user.matchingConfig.genders, user.gender)\n    if(p.user.matchingConfig.genders.includes(user.gender)){\n      if(user.matchingConfig.genders.includes(p.user.gender)){\n        return true\n      }\n    }\n    return false\n  })\n\n  console.log('filterde gender', filteredGender)\n\n  if(!!filteredGender[0]){\n    removeFromBucket(filteredGender[0].id, lang);\n    removeFromBucket(socketId, lang);\n    io.to(filteredGender[0].id).emit('match', user);\n    io.to(socketId).emit('match', filteredGender[0].user);\n  }\n}\n\nio.on('connection', (socket: any) => {\n\n  socket.once('add_user', (user: UserType) => {\n    if(!user?.uid || user?.age < 18 || !user?.matchingConfig.lang) return;\n    if(!langsBucket[user?.matchingConfig.lang]) langsBucket[user?.matchingConfig.lang] = [];\n    console.log(`\n    new user: \n    socket id: ${socket.id}\n    firebase uid: ${user.uid}\n    `);\n    onUserAdd(user, socket.id);\n    console.log(user);\n  })\n\n  socket.on(\"disconnect\", (reason: any) => {\n    console.log(`\n    user exist: ${socket.id}\n    `);\n    removeFromBucket(socket.id);\n  })\n});\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA,oBAAe;AAGf,mBAA8B;AAE9B,IAAI,cAA+B,CAAC;AAEpC,MAAM,mBAAmB,CAAC,IAAY,SAAkB;AACtD,MAAI,MAAM;AACR,UAAM,QAAQ,YAAY,MAAM,UAAU,SAAO,IAAI,OAAO,EAAE;AAC9D,QAAI,UAAU;AAAI;AAClB,gBAAY,MAAM,OAAO,OAAO,CAAC;AAAA,EACnC,OAAO;AAEL,WAAO,OAAO,WAAW,EAAE,QAAQ,CAAAA,UAAQ;AACzC,YAAM,QAAQA,MAAK,UAAU,SAAO,IAAI,OAAO,EAAE;AACjD,UAAI,UAAU,IAAI;AAChB,QAAAA,MAAK,OAAO,OAAO,CAAC;AAAA,MACtB;AAAA,IACF,CAAC;AAAA,EACH;AACF;AAGA,MAAM,YAAY,CAAC,MAAgB,aAAqB;AAEtD,UAAQ,IAAI,eAAe;AAE3B,QAAM,OAAO,KAAK,eAAe;AACjC,QAAM,EAAC,MAAM,GAAE,IAAI,KAAK;AAExB,cAAY,GAAG,QAAQ,KAAK,EAAC,IAAI,UAAU,KAAI,CAAC;AAEhD,QAAM,eAAe,YAAY,GAAG,QAAQ,OAAO,OAAK,EAAE,KAAK,QAAQ,KAAK,GAAG;AAE/E,QAAM,cAAc,aAAa,OAAO,OAAK;AAC3C,UAAM,IAAI,EAAE,KAAK,eAAe;AAChC,UAAM,IAAI,EAAE,KAAK,eAAe;AAChC,eAAO,4BAAc,EAAE,KAAK,KAAK,CAAC,MAAM,EAAE,CAAC,SAAK,4BAAc,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC;AAAA,EAChF,CAAC;AAED,QAAM,iBAAiB,YAAY,OAAO,OAAK;AAC7C,YAAQ,IAAI,EAAE,KAAK,eAAe,SAAS,EAAE,KAAK,MAAM;AACxD,YAAQ,IAAI,KAAK,eAAe,SAAS,KAAK,MAAM;AACpD,QAAG,EAAE,KAAK,eAAe,QAAQ,SAAS,KAAK,MAAM,GAAE;AACrD,UAAG,KAAK,eAAe,QAAQ,SAAS,EAAE,KAAK,MAAM,GAAE;AACrD,eAAO;AAAA,MACT;AAAA,IACF;AACA,WAAO;AAAA,EACT,CAAC;AAED,UAAQ,IAAI,mBAAmB,cAAc;AAE7C,MAAG,CAAC,CAAC,eAAe,IAAG;AACrB,qBAAiB,eAAe,GAAG,IAAI,IAAI;AAC3C,qBAAiB,UAAU,IAAI;AAC/B,kBAAAC,QAAG,GAAG,eAAe,GAAG,EAAE,EAAE,KAAK,SAAS,IAAI;AAC9C,kBAAAA,QAAG,GAAG,QAAQ,EAAE,KAAK,SAAS,eAAe,GAAG,IAAI;AAAA,EACtD;AACF;AAEA,cAAAA,QAAG,GAAG,cAAc,CAAC,WAAgB;AAEnC,SAAO,KAAK,YAAY,CAAC,SAAmB;AAC1C,QAAG,EAAC,6BAAM,SAAO,6BAAM,OAAM,MAAM,EAAC,6BAAM,eAAe;AAAM;AAC/D,QAAG,CAAC,YAAY,6BAAM,eAAe;AAAO,kBAAY,6BAAM,eAAe,QAAQ,CAAC;AACtF,YAAQ,IAAI;AAAA;AAAA,iBAEC,OAAO;AAAA,oBACJ,KAAK;AAAA,KACpB;AACD,cAAU,MAAM,OAAO,EAAE;AACzB,YAAQ,IAAI,IAAI;AAAA,EAClB,CAAC;AAED,SAAO,GAAG,cAAc,CAAC,WAAgB;AACvC,YAAQ,IAAI;AAAA,kBACE,OAAO;AAAA,KACpB;AACD,qBAAiB,OAAO,EAAE;AAAA,EAC5B,CAAC;AACH,CAAC;",
  "names": ["lang", "io"]
}
